---
title: |
  ECON-S307  
  Séminaire d'économie appliquée - Prix
subtitle: "Séance d'introduction" 
author: "Owen Brown"
date: today
bibliography: ref.bibtex
biblio-style: natbib
bibliographystyle: apa
project:
    output-dir: docs
date-format: long
execute: 
  fig-format: png   
  cache: true
  freeze: auto
  
lightbox: true
format: 
  revealjs:
    output-file: seminaire_intro.html
    logo: images/clipboard-1578115461.png
    css: styles.css
    width: 1500
    margin: 0.075
    slide-number: true
    pdf: true
  
---

```{r, verbose = FALSE}
source("lib.R")
source("data_forProj.R")
set.seed(1234)
puissance <- rnorm(5000,200,75)
poids <- rnorm(5000,500,250)+0.2*puissance

prix <- 3500+0.5*puissance-1*poids+rnorm(5000,150,100)

dta <- tibble(prix,puissance,poids)

fmla <- prix~ 1000+0.5*puissance-0.10*poids

#| include: false
knitr::opts_chunk$set(warning = FALSE,
  error   = FALSE
)
```

## Objectif de la séance

<br/>

L'objectif de cette séance sera de revenir sur l'organisation du cours
et du matériel que nous emploierons. Nous discuterons:

::: incremental
- de l'objectif général du projet
- des outils mobilisables pour ce projet
- du travail final à rendre
:::


## Structure du projet

Chaque groupe doit rédiger un projet de 4 pages / membre (page de garde, appendix et
références exclues - taille de police 12). Le projet doit prendre la forme suivante : 

::: incremental
::: {style="line-height:1"}
0.  **Page de garde** - titre, noms, matricules
1. **Revue de littérature** - synthèse de la recherche relative à votre bien 
2. **Discussion de la source de données** - justification, fiabilité,méthode de récolte 
3. **Analyse descriptive des données** - sommaire des variables, graphiques, tables
4. **Méthode, résultats, discussion** -  spécification de la régression hédonique, estimation de modèle, discussion des résultats, liens contextuels
5. **Références & Appendix** 
:::
:::

. . .

Le travail comprendra en préambule une table de matières ainsi qu'une table de graphiques.

## Remise & défense de projet

::: noincremental
::: {style="line-height:1"}
- Votre fichier devra être remis **sur l'UV sous format PDF**.
- En indiquant votre numéro de groupe et vos noms (de famille) par ordre alphabétique, vous nommerez votre le fichier de votre travail :

::: {style="text-align: center"}
"[GRP_] - Séminaire d'économie appliquée (Prix)_NOM_1-NOM_2-NOM_3.pdf". 
:::
:::
:::
. . .

::: noincremental
::: {style="line-height:1"}
- Vous devrez également soumettre votre jeu de données ainsi que votre code. **Il est impératif que le code que vous communiquez produise exactement les mêmes résultats que votre travail.** 
- Votre code devra être commenté. Chaque étape clé devra être clairement indiquée et brièvement décrite.

::: {style="text-align: center"}
 "[GRP_] - Code_NOM_1-NOM_2-NOM_3.R" <br>
 "[GRP_] - Dataset_NOM_1-NOM_2-NOM_3.csv"
:::
:::
:::

## Dates du projet

::: incremental
- **1er mars - 23h59** : Remettre une note  dans laquelle vous expliquez quel bien vous souhaitez analyser et expliquez comment vous construirez un jeu de données (1 page max).
<center>
*\[GRP\_\] - Note 1 (Prix)\_NOM\_1-NOM\_2-NOM\_3.pdf*
</center>
- **15 mars - 23h59** : Remettre une note dans laquelle vous expliquez votre avancée de récolte de données - Méthode employée, source, quantité de données, objectifs (2 pages max). 
<center>
*\[GRP\_\] - Note 2 (Prix)\_NOM\_1-NOM\_2-NOM\_3.pdf*
  </center>
- **30 avril - 23h59** : Remettre votre travail sur l'UV
  + Votre rapport final - **format PDF**
  + Vos documents annexes - Jeu de données, codes
:::



# Des questions ?


## Du projet

::: incremental
1.  L'objectif de ce projet est de vous faire mesurer. Mesurer, c'est
    central en économie appliquée.
2.  Votre objet d'étude sera un bien.
3.  Vous devrez mesurer la contribution des caractéristiques d'un bien
    au prix de ce bien.
:::

. . .

→ Ceci peut être réalisé avec des outils économétriques : les
régressions hédoniques.

. . .

Une régression hédonique décompose le prix en ses constituants
caractéristiques, et fournit une estimation de la valeur contributaire
de chaque caractéristique.


## Rappel - L'économétrie [@woolridge]{.smalltext}

L'économétrie est un outil fondé sur des méthodes statistiques ayant
pour but :

::: incremental
-   d'estimer des relations économiques
-   de tester des théories
-   de mesurer des effets
:::

. . .

Cet outil nous permet de mesurer la contribution d'une caractéristique
au prix d'un bien.

## Exemple

Imaginons que nous voulions estimer le prix d'une voiture selon ses
caractéristiques.

. . .

D'intuition, nous dirions que le prix de la voiture dépend de plusieurs
facteurs, notamment :

::: noincremental
1.  Sa puissance (+)
2.  Son poids (-)
:::

## Exemple

Faisant l'hypothèse que la relation entre le prix et les
caractéristiques prend une forme fonctionelle suivante:

\begin{equation}
Prix_i =  \beta_1 \cdot Puissance_i  + \beta_2 \cdot Poids_i
\end{equation}

. . .

L'économétrie nous permet d'estimer les coefficients $\beta$.

. . .

Si notre intuition s'avère correcte, une OLS délivrerait des estimations
telles que :

::: noincremental
-   $\hat{\beta_1}>0$
-   $\hat{\beta_2}<0$
:::

## Données

Soit un jeu de données à notre disposition:

```{r,echo=TRUE}
#| warning: false
dta %>% select(c("prix","puissance","poids")) %>% summary
dta %>% select(c("prix","puissance","poids")) %>% dim
```

## Testons notre modèle

Une estimation par la méthode des moindres carrés (OLS) nous donne:

```{r,echo=TRUE}
reg <- dta %>% lm(formula= prix ~poids+ puissance-1)  
reg %>% tidy %>% kbl() %>% kable_styling(font_size = 35) 
```

. . .

Les deux variables ont un effet positif sur le prix. Les p-valeurs sont
significatives à plus de 99% de confiance !

## Réfléchir à sa modélisation

::: noincremental
::: {style="line-height:1"}
-   Nos estimations contredisent notre hypothèse
    ($\hat{\beta}_{poids}>0$). Est-ce que nos résultats ont du sens ?
-   Représentons nos données
:::
:::

. . .


::: {style="text-align: center"}
```{r,echo=FALSE}
#| fig-height: 6.5
#| fig-width: 12

df_long <- dta %>% 
  mutate(fittedval=reg$fitted.values) %>% 
  pivot_longer(cols = c(prix, fittedval),
    names_to = "type",
    values_to = "value")
df_long %>% ggplot(aes(x=poids,y=value))+
  geom_point(color="steelblue1")+
  facet_wrap(~type,labeller = labeller(type = 
    c("fittedval" = "Valeurs prédites",
      "prix" = "Valeurs observées")))+
  labs(title = "Régression VS. Réalité")
```
:::

## Revoir le modèle - I 

-   Ne faudrait-il pas un intercept ? 
\begin{equation}
    Prix_i = \alpha_0 + \beta_1 \cdot Puissance_i  + \beta_2 \cdot Poids_i
\end{equation}

. . .


```{r,echo=TRUE}
reg2 <- dta %>% lm(formula= prix ~poids+ puissance)  
reg2 %>% tidy %>% kbl() %>% kable_styling(font_size = 35) 
```


## Revoir le modèle - II

::: {style="text-align: center"}
```{r echo=FALSE}
#| fig-height: 7
#| fig-width: 10

df_long <- dta %>% 
  mutate(fittedval=reg2$fitted.values) %>% 
  pivot_longer(cols = c(prix, fittedval),
    names_to = "type",
    values_to = "value")
df_long %>% ggplot(aes(x=poids,y=value))+
  geom_point(color="steelblue1")+
  facet_wrap(~type,labeller = labeller(type = 
    c("fittedval" = "Valeurs prédites",
      "prix" = "Valeurs observées")))+
  labs(title = "Régression VS. Réalité")
```
:::

. . .

Beaucoup plus cohérent !

## Problème résolu ?

Qu'avons nous comme outil pour évaluer s'il y a une potentielle erreur
de mesure ?

. . .

Comparons l'hétéroscédasticité ($\sigma^2$) des deux modèles:

::: {style="text-align: center"}
```{r,echo=FALSE}
library(plotly)
#| fig-height: 8
#| fig-width: 12
data <- tibble(poids=dta$poids,
               res1=reg$residuals^2,
               res2=reg2$residuals^2,
               puissance=dta$puissance) %>% 
  pivot_longer(cols=c(res1,res2), names_to = "group",values_to = "residuals")
data %>% ggplot(aes(x=poids,y=residuals))+
  geom_point(color="steelblue")+
  facet_wrap(~group,labeller = labeller(group = 
    c("res1" = "Modèle 1",
      "res2" = "Modèle 2")))+
  labs(title = "Comparaison de modèles - Carré des résidus ")  

```
:::

Notre second modèle semble beaucoup plus adapté.

## Remarques

::: noincremental
-   Une *p-valeur* significative n'implique pas automatiquement que
    votre régression est correcte !
-   Soyez toujours critiques de votre modélisation :
    -   Est-ce que mes coefficients ont du sens ?
    -   Ai-je à disposition un outil pour tester la véracité de mes
        résultats ?
-   Codez ! Appliquer la théorie économétrique est un moyen précieux de
    rendre cette discipline plus claire.
:::

## À vous !

::: incremental
-   Pour le projet il vous sera demandé de constituer une base de
    données. Vous pouvez récolter des données où vous le désirez, **tant
    que vous obtenez un jeu de données réelles**.
-   Rassembler des données peut être couteux. Toutefois avec
    internet,vous avez à dispositions une masse considérable de données.
    Mais comment les réunir ?
-   Le webscraping !
:::

## Le webscraping

::: incremental
1.  Le *webscraping* est une méthode d'extraction de données de site web
2.  Cette méthode exploite la structure des pages pour récupérer
    automatiquement de l'information
3.  Elle s'avère très efficace pour constituer rapidement un jeu
    important de données !
4.  En revanche, parce qu'un grand nombre de données en récolté, un
    travail de nettoyage de données est souvent nécessaire
:::

. . .

## La structure des pages ?

Les sites web que nous voyons sont en réalité une interprétation de code
HTML.

::::: columns
::: column
![](Screen%20Shot%202026-02-02%20at%2023.42.19.png){width="130%"}
:::

::: column
![](Capture%20d’écran%202026-02-02%20234320.png){.lightbox width="70%"}
:::
:::::

## Scraper une page - I

::: noincremental
-   À quelques exceptions près, tous les sites web suivent un structure
    par "balise"
-   Avec `R` ou `Python` et la libraire *Selenium*, il est possible de
    simuler une navigation internet et d'enregister de l'information
    contenu dans un code *HTML*.
:::

## Scraper une page - II

Par étape :

::: incremental
1.  Trouver une page type qui contient l'information sur le bien
    d'intérêt
2.  Comprendre la structure du site
3.  Localiser les balises d'information
4.  Automatiser la navigation
5.  Récolter les données et les stocker dans un fichier lisible par
    votre programme statistique
:::

# Un exemple peut-être ?

## Le prix des téléphones

Quels sont les éléments constitutifs des prix de téléphone ?

-   Le stockage
-   La marque
-   L'autonomie
-   La performance

. . .

Créons un jeu de données !

## Jeu de donnée

Après la récolte automatisée ainsi que le nettoyage des données, nous
obtenons un jeu tel que suit :

```{r}
#| echo: true
#| class: scrollable
phonesdf %>% print(n=28)
```

## Notre régression hédonique - I

Sur base de ce qui a été récolté, nous pouvons évaluer la contribution
des diverses caractéristiques des biens à l'aide de la régression
hédonique suivante:

```{=latex}
\begin{equation}
\begin{aligned}
Prix_{i,m} =\;& \alpha_m 
+ \beta_1 \cdot Poids_i \\
&+ \beta_2 \cdot megapixels_i \\
&+ \beta_3 \cdot age_i
+ \beta_4 \cdot RAM_i
+ \beta_5 \cdot stockage_i \\
&+ \beta_6 \cdot Qualité\_Camera_i
+ \varepsilon_{i,m}
\end{aligned}
\end{equation}
```

## Notre régression hédonique - II

```{r echo=TRUE}
#| warning: false

preg2 <- linear_reg() %>% set_engine("lm") %>% 
  fit( price~ Poids + megapixels + factor(age) + RAM + 
         stockage + (`Qualité de la caméra`)+(Marque), data = phonesdf) 

preg2 %>% tidy %>% kbl() %>% kable_styling(full_width = F,font_size = 20) %>% 
   row_spec(c(10:12),background = "steelblue1")
```

## Notre régression hédonique - III

::: {style="text-align: center"}
```{r}
#| fig-cap: "Coefficients de régression hédonique"
#| fig-height: 6
#| fig-width: 20
tidy(preg2)%>% 
  mutate(term = reorder(term, estimate),
    conf.low  = estimate - 1.96 * std.error,
    conf.high = estimate + 1.96 * std.error) %>%
  ggplot(aes(x = estimate, y = term)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey50") +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high),
    height = 0.2,
    color = "grey40") +
  geom_point(size = 3, color = "#0072B2") +
  labs(x = "Coefficient estimate",
    y = NULL,
    title = "Coefficient plot with 95% confidence intervals") +
  theme_minimal(base_size = 21)
```
:::

. . .

On observe une nette différence entre les prix de Samsung / Google /
OnePlus et ceux de Apple !

## Notre régression hédonique - IV

Discuter ses résultats

::: incremental
-   Le signe des coefficients
-   La forme fonctionnelle
-   L'expression des variables explicatives (quantitative vs
    qualitative)
-   Pourquoi observe-t-on de tels résultats ? -\> Recherche contextuelle
    !
-   Comparer les marchés !
    -   Une autre enseigne établit-elle des prix différents ?
:::


## Remarques

:::incremental
- Ceci est une méthode de récolte de données. Vous être libres de récolter des données autrement. Des sites recensent des jeux de données existantes.

- Votre travail devra être rigoureusement référencé (sites, articles scientifiques, actualité). Tout plagiat sera sévèrement et indiscutablement sanctionné.

- Vous êtes libres d'utiliser le logiciel statistique que vous préférez... mais choisissez-le bien !

- Une séance pourra être organisée pour introduire l'utilisation de `R` ainsi que les bonnes pratiques d'usage ainsi qu'une guidance pour d'éventuelles questions.

- Mobilisez vos connaissances d'autres cours ! **cf.** *Méthode et modélisation économique* & *Introduction à l'économétrie*
:::

## Prochaines échéances

::: incremental

- **1er mars - 23h59** : Remettre une note (1 page max) dans laquelle vous expliquez quel bien vous souhaitez analyser et expliquez comment vous construirez un jeu de données.

  :::{style="text-align: center"}
*\[GRP\_\] - Note 1 (Prix)\_NOM\_1-NOM\_2-NOM\_3.pdf*
  :::

- **15 mars - 23h59** : Remettre une note dans laquelle vous expliquez votre avancée de récolte de données - Méthode employée, source, quantité de données, objectifs (2 pages max) 

  :::{style="text-align: center"}
*\[GRP\_\] - Note 2 (Prix)\_NOM\_1-NOM\_2-NOM\_3.pdf*
  :::
:::
. . . 

::: {style="text-align: center"}
**Bon travail !**
:::


## Liens utiles
Certains sites recensent des bases de données, notamment:

:::noincremental
::: {style="line-height:1"}
- [Kaggle](https://www.kaggle.com/):https://www.kaggle.com
- [Google Dataset Search](https://datasetsearch.research.google.com/):https://datasetsearch.research.google.com
- [UC Irvine Machine learning repository](https://archive.ics.uci.edu/):https://archive.ics.uci.edu/
:::
::: 

/!\\  Si vous exploitez une base de données que vous n'avez pas constitué vous-mêmes, il est exigé de référencer dûment les auteurs et autrices du jeu de données.


::: noincremental
::: {style="line-height:1"}
- [Tutoriel vidéo d'installation R & Rstudio](https://www.youtube.com/watch?v=hhqhyexDrsg): https://www.youtube.com/watch?v=hhqhyexDrsg
- [Tutoriel d'installation Pycharm](https://www.jetbrains.com/help/pycharm/installation-guide.html#toolbox):https://www.jetbrains.com/help/pycharm/installation-guide.html#toolbox
- [Tutoriel vidéo d'utilisation Selenium (Webscraping)](https://www.youtube.com/watch?v=NB8OceGZGjA):https://www.youtube.com/watch?v=NB8OceGZGjA
:::
:::



## Bibliographie {.scrollable}

::: {#refs}
:::
